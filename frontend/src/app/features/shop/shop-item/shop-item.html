<div
  class="group relative flex flex-col bg-white rounded-[2rem] p-3 shadow-sm border border-spirit-primary/5 transition-all hover:shadow-xl h-full">
  <div class="relative aspect-square overflow-hidden rounded-[1.5rem] bg-spirit-background">
    <img [src]="product().imageUrl"
         [routerLink]="['/boutique', product().id]"
         class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-110 cursor-pointer"
         [alt]="product().name">

    <!-- Badge Type -->
    @if (product().type !== 'PHYSICAL') {
      <div
        class="absolute top-3 left-3 px-2 py-1 bg-white/90 backdrop-blur-sm rounded-lg text-[10px] font-bold text-spirit-primary uppercase tracking-wider shadow-sm">
        {{ product().type === 'COACHING' ? 'Coaching' : 'Service' }}
      </div>
    }

  </div>

  <div class="p-3 space-y-2 flex flex-col flex-grow">
    <div>
      <h3 class="font-serif text-lg text-spirit-primary leading-tight line-clamp-2 min-h-[3.5rem] cursor-pointer"
          [routerLink]="['/boutique', product().id]">{{ product().name }}</h3>
      <p
        class="text-[10px] uppercase tracking-widest text-gray-400 font-bold mt-1">{{ stonesList() }}</p>
    </div>

    <!-- VARIANTES (Chips) -->
    @if (product().variants && product().variants!.length > 0) {
      <div class="flex flex-wrap gap-1.5 mt-2">
        @for (variant of product().variants; track variant.id) {
          <button (click)="selectVariant($event, variant)"
                  class="px-2 py-1 text-[10px] rounded-md border transition-colors"
                  [class.bg-spirit-primary]="selectedVariant()?.id === variant.id"
                  [class.text-white]="selectedVariant()?.id === variant.id"
                  [class.border-spirit-primary]="selectedVariant()?.id === variant.id"
                  [class.bg-white]="selectedVariant()?.id !== variant.id"
                  [class.text-gray-600]="selectedVariant()?.id !== variant.id"
                  [class.border-gray-200]="selectedVariant()?.id !== variant.id">
            {{ variant.durationMonths }} mois
          </button>
        }
      </div>
    }

    <div class="flex items-end justify-between pt-2 mt-auto">
      <div class="flex flex-col">
        <span class="text-xs text-gray-400 font-medium">Prix</span>
        <span class="text-xl font-bold text-spirit-primary">{{ displayPrice() }}€</span>
      </div>

      <!-- Bouton d'action : Ajout panier (Physique) OU Voir détail (Service) -->
      @if (product().type === 'PHYSICAL') {
        <button (click)="addToCart($event)"
                class="h-10 w-10 flex items-center justify-center rounded-2xl bg-spirit-primary text-white shadow-lg shadow-spirit-primary/20 active:scale-90 transition-transform">
          <mat-icon>add</mat-icon>
        </button>
      } @else {
        <button [routerLink]="['/boutique', product().id]"
                class="h-10 w-10 flex items-center justify-center rounded-2xl bg-spirit-primary/10 text-spirit-primary active:scale-90 transition-transform">
          <mat-icon>calendar_month</mat-icon>
        </button>
      }
    </div>
  </div>
</div>
